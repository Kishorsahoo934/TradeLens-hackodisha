<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Workspace - TradeLens</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-chart-line"></i>
                <span>TradeLens</span>
            </div>


            
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="learning.html" class="nav-link">Learning</a>
                <a href="prediction.html" class="nav-link active">Predict</a>
                <a href="community.html" class="nav-link">Community</a>
                <div class="user-menu">
                    <span id="userName">Loading...</span>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Prediction Header -->
            <section class="prediction-header">
                <div class="header-content">
                    <h1><i class="fas fa-crystal-ball"></i> Prediction Workspace</h1>
                    <p>Make your prediction and compare with our AI mentor</p>
                </div>
                <div class="current-price" id="currentPrice">
                    <div class="price-label">BTC/USD</div>
                    <div class="price-value">$43,250.00</div>
                    <div class="price-change positive">+2.3%</div>
                </div>
            </section>

            <!-- Prediction Form -->
            <section class="prediction-workspace">
                <div class="workspace-grid">
                    <!-- Left Panel - Prediction Form -->
                    <div class="prediction-panel">
                        <div class="panel-header">
                            <h2>Your Prediction</h2>
                            <div class="lesson-context" id="lessonContext" style="display: none;">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Apply your RSI knowledge</span>
                            </div>
                        </div>
                        
                        <form class="prediction-form" onsubmit="submitPrediction(event)">
                            <!-- Asset Selection -->
                            <div class="form-group">
                                <label>Asset</label>
                                <select id="assetSelect" onchange="updateAssetPrice()">
                                    <option value="BTC">Bitcoin (BTC)</option>
                                    <option value="ETH">Ethereum (ETH)</option>
                                    <option value="ADA">Cardano (ADA)</option>
                                </select>
                            </div>

                            <!-- Timeframe Selection -->
                            <div class="form-group">
                                <label>Timeframe</label>
                                <div class="timeframe-buttons">
                                    <button type="button" class="timeframe-btn active" data-timeframe="1h">1 Hour</button>
                                    <button type="button" class="timeframe-btn" data-timeframe="4h">4 Hours</button>
                                    <button type="button" class="timeframe-btn" data-timeframe="1d">1 Day</button>
                                </div>
                            </div>

                            <!-- Direction Prediction -->
                            <div class="form-group">
                                <label>Price Direction</label>
                                <div class="direction-buttons">
                                    <button type="button" class="direction-btn up" data-direction="UP">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>UP</span>
                                    </button>
                                    <button type="button" class="direction-btn down" data-direction="DOWN">
                                        <i class="fas fa-arrow-down"></i>
                                        <span>DOWN</span>
                                    </button>
                                    <button type="button" class="direction-btn flat" data-direction="FLAT">
                                        <i class="fas fa-arrows-alt-h"></i>
                                        <span>SIDEWAYS</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Confidence Level -->
                            <div class="form-group">
                                <label>Confidence Level: <span id="confidenceValue">50</span>%</label>
                                <div class="confidence-slider-container">
                                    <input type="range" id="confidenceSlider" min="10" max="100" value="50" 
                                           oninput="updateConfidence(this.value)">
                                    <div class="confidence-labels">
                                        <span>Low</span>
                                        <span>Medium</span>
                                        <span>High</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Rationale -->
                            <div class="form-group">
                                <label>Your Rationale</label>
                                <textarea id="rationale" placeholder="Explain your prediction reasoning (e.g., RSI levels, volume analysis, market trends...)" 
                                          rows="4" required></textarea>
                                <div class="rationale-tips">
                                    <i class="fas fa-lightbulb"></i>
                                    <span>Tip: Mention technical indicators you learned about!</span>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-primary btn-large prediction-submit">
                                <i class="fas fa-rocket"></i>
                                Make Prediction
                            </button>
                        </form>
                    </div>

                    <!-- Right Panel - Chart & Indicators -->
                    <div class="chart-panel">
                        <div class="panel-header">
                            <h2>Market Analysis</h2>
                            <div class="chart-controls">
                                <button class="chart-btn active" onclick="showIndicator('price')">Price</button>
                                <button class="chart-btn" onclick="showIndicator('rsi')">RSI</button>
                                <button class="chart-btn" onclick="showIndicator('volume')">Volume</button>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chartContainer">
                            <div class="mock-chart">
                                <div class="chart-title">BTC/USD - 1H Chart</div>
                                <div class="price-chart-mock">
                                    <!-- Mock candlestick chart -->
                                    <div class="candle-container">
                                        <div class="candle green" style="left: 10%; height: 60%"></div>
                                        <div class="candle red" style="left: 20%; height: 40%"></div>
                                        <div class="candle green" style="left: 30%; height: 80%"></div>
                                        <div class="candle green" style="left: 40%; height: 70%"></div>
                                        <div class="candle red" style="left: 50%; height: 50%"></div>
                                        <div class="candle green" style="left: 60%; height: 90%"></div>
                                        <div class="candle red" style="left: 70%; height: 30%"></div>
                                        <div class="candle green" style="left: 80%; height: 85%"></div>
                                        <div class="candle current" style="left: 90%; height: 75%"></div>
                                    </div>
                                    <div class="current-price-line">$43,250</div>
                                </div>
                                
                                <!-- RSI Indicator -->
                                <div class="rsi-indicator" id="rsiIndicator">
                                    <div class="indicator-title">RSI (14)</div>
                                    <div class="rsi-chart">
                                        <div class="rsi-levels">
                                            <div class="rsi-line overbought">70</div>
                                            <div class="rsi-line oversold">30</div>
                                        </div>
                                        <div class="rsi-value" style="bottom: 78%">
                                            <span class="rsi-number">78</span>
                                        </div>
                                    </div>
                                    <div class="rsi-status overbought">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Overbought Territory
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Market Insights -->
                        <div class="market-insights">
                            <h3>Key Observations</h3>
                            <div class="insight-list">
                                <div class="insight-item">
                                    <i class="fas fa-chart-line text-warning"></i>
                                    <span>RSI at 78 indicates overbought conditions</span>
                                </div>
                                <div class="insight-item">
                                    <i class="fas fa-volume-up text-info"></i>
                                    <span>Volume declining over last 3 candles</span>
                                </div>
                                <div class="insight-item">
                                    <i class="fas fa-trending-up text-success"></i>
                                    <span>Price still in upward trend</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- AI Mentor Results Modal -->
    <div id="mentorModal" class="modal">
        <div class="mentor-modal-content">
            <div class="mentor-header">
                <h2><i class="fas fa-robot"></i> AI Mentor Analysis</h2>
                <button class="close" onclick="closeMentorModal()">&times;</button>
            </div>
            
            <div class="comparison-section">
                <div class="prediction-comparison">
                    <div class="user-prediction">
                        <h3>Your Prediction</h3>
                        <div class="prediction-display" id="userPredictionDisplay">
                            <!-- User prediction will be populated here -->
                        </div>
                    </div>
                    
                    <div class="vs-divider">
                        <span>VS</span>
                    </div>
                    
                    <div class="ai-prediction">
                        <h3>AI Mentor</h3>
                        <div class="prediction-display" id="aiPredictionDisplay">
                            <!-- AI prediction will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="mentor-explanation">
                <h3><i class="fas fa-brain"></i> AI Reasoning (SHAP Analysis)</h3>
                <div class="explanation-content" id="explanationContent">
                    <!-- AI explanation will be populated here -->
                </div>
                
                <div class="feature-importance">
                    <h4>Top Contributing Factors:</h4>
                    <div class="feature-list" id="featureList">
                        <!-- Feature importance will be populated here -->
                    </div>
                </div>
            </div>

            <div class="risk-assessment">
                <h3><i class="fas fa-shield-alt"></i> Risk Assessment</h3>
                <div class="risk-content" id="riskContent">
                    <!-- Risk assessment will be populated here -->
                </div>
            </div>

            <div class="mentor-actions">
                <button class="btn btn-primary" onclick="shareToCommunity()">
                    <i class="fas fa-share"></i>
                    Share to Community
                </button>
                <button class="btn btn-secondary" onclick="makeAnotherPrediction()">
                    <i class="fas fa-redo"></i>
                    Make Another Prediction
                </button>
            </div>
        </div>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/ml-mentor.js"></script>
    <script src="../js/prediction.js"></script>
</body>
</html>
